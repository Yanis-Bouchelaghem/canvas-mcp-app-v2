# TypeScript Configurations

MCP Apps require two separate TypeScript configs: one for the React frontend (bundled by Vite) and one for the Node.js server.

## tsconfig.json (React/Vite)

For the React frontend, used by Vite:

```json
{
  "compilerOptions": {
    "target": "ESNext",
    "lib": ["ESNext", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "verbatimModuleSyntax": true,
    "noEmit": true,
    "jsx": "react-jsx",
    "strict": true,
    "skipLibCheck": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true
  },
  "include": ["src"]
}
```

Key settings:
- `noEmit: true` - Vite handles compilation
- `jsx: "react-jsx"` - Modern React JSX transform
- `moduleResolution: "bundler"` - For Vite compatibility

## tsconfig.server.json (Node.js)

For the server-side code:

```json
{
  "compilerOptions": {
    "target": "ES2022",
    "lib": ["ES2022"],
    "module": "NodeNext",
    "moduleResolution": "NodeNext",
    "declaration": true,
    "emitDeclarationOnly": true,
    "outDir": "./dist",
    "rootDir": ".",
    "strict": true,
    "skipLibCheck": true,
    "esModuleInterop": true,
    "resolveJsonModule": true
  },
  "include": ["server.ts", "main.ts", "tools/**/*.ts"]
}
```

Key settings:
- `module: "NodeNext"` - Modern Node.js ESM
- `declaration: true` - Generate .d.ts files
- `emitDeclarationOnly: true` - TypeScript only generates types (bundler handles JS)

## vite.config.ts

```typescript
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";
import { viteSingleFile } from "vite-plugin-singlefile";

const INPUT = process.env.INPUT;
if (!INPUT) {
  throw new Error("INPUT environment variable is not set");
}

const isDevelopment = process.env.NODE_ENV === "development";

export default defineConfig({
  plugins: [react(), viteSingleFile()],
  build: {
    sourcemap: isDevelopment ? "inline" : undefined,
    cssMinify: !isDevelopment,
    minify: !isDevelopment,
    rollupOptions: {
      input: INPUT,
    },
    outDir: "dist",
    emptyOutDir: false,
  },
});
```

Key points:
- `viteSingleFile()` - Bundles everything into one HTML file
- `INPUT` env var - Specifies which HTML file to build
- `emptyOutDir: false` - Don't delete server output

## package.json Scripts

```json
{
  "type": "module",
  "scripts": {
    "build": "tsc --noEmit && cross-env INPUT=mcp-app.html vite build && tsc -p tsconfig.server.json",
    "watch": "cross-env INPUT=mcp-app.html vite build --watch",
    "serve": "tsx main.ts",
    "dev": "concurrently 'npm run watch' 'npm run serve'",
    "start": "npm run build && npm run serve"
  }
}
```

Build order:
1. `tsc --noEmit` - Type-check React code
2. `vite build` - Bundle React into single HTML
3. `tsc -p tsconfig.server.json` - Compile server types

## CSS Module Support

For `.module.css` files with TypeScript:

```typescript
// src/mcp-app.module.css.d.ts (auto-generated by Vite)
declare const styles: {
  readonly main: string;
  readonly button: string;
  // ...
};
export default styles;
```

Or add a global declaration:

```typescript
// src/vite-env.d.ts
/// <reference types="vite/client" />

declare module "*.module.css" {
  const classes: { readonly [key: string]: string };
  export default classes;
}
```
